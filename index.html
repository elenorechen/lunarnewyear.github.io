<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOLARE 行動飛行劇院｜好運籤詩馬上到</title>
    
    <!-- 設定 Open Graph 標籤 -->
    <meta property="og:title" content="VOLARE 行動飛行劇院｜好運籤詩馬上到">
    <meta property="og:description" content="天馬行空飛高高，好運籤詩馬上到！快來 VOLARE 行動飛行劇院抽取您的 2026 年專屬運勢籤詩！">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://elenorechen.github.io/lunarnewyear.github.io/volare_newyearthumb.jpg">

    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 html2canvas (用於截圖) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Serif TC', serif;
            background-color: #8B0000;
        }

        /* 閃爍動畫 */
        @keyframes shine {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        .animate-shine {
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
            background-size: 200% 100%;
            animation: shine 2s infinite;
        }

        /* 籤桶晃動動畫 */
        @keyframes shake {
          0% { transform: rotate(0deg); }
          20% { transform: rotate(-8deg); }
          40% { transform: rotate(8deg); }
          60% { transform: rotate(-8deg); }
          80% { transform: rotate(8deg); }
          100% { transform: rotate(0deg); }
        }
        .animate-shake {
          animation: shake 0.6s cubic-bezier(.36,.07,.19,.97) infinite;
        }

        /* 漸變進入 */
        @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(30px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
          animation: fadeInUp 0.8s ease-out forwards;
        }

        /* 金粉飄落效果 */
        .gold-particle {
          position: absolute;
          background: radial-gradient(circle, #FFD700 0%, transparent 70%);
          border-radius: 50%;
          pointer-events: none;
          z-index: 5;
          opacity: 0;
          animation: fall linear infinite;
        }
        @keyframes fall {
          0% { transform: translateY(-10vh) translateX(0) rotate(0deg); opacity: 1; }
          100% { transform: translateY(110vh) translateX(50px) rotate(360deg); opacity: 0; }
        }

        /* 傳統印章質感 */
        .seal-font {
            writing-mode: vertical-rl;
            text-orientation: upright;
            letter-spacing: 0.1em;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>

    <!-- Firebase SDK (保持原邏輯) -->
    <script type="module">
        import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

        const GLOBAL_FB_KEY = '__2026_FORTUNE_FB_PROMISE_V10__';
        window[GLOBAL_FB_KEY] = new Promise(async (resolve) => {
            if (!window.__firebase_config) { resolve(null); return; }
            try {
                const config = JSON.parse(window.__firebase_config);
                const app = getApps().length === 0 ? initializeApp(config) : getApps()[0];
                const auth = getAuth(app);
                const db = getFirestore(app);
                const appId = window.__app_id || 'default-app-id';
                onAuthStateChanged(auth, async (user) => {
                    if (!user) {
                        if (window.__initial_auth_token) await signInWithCustomToken(auth, window.__initial_auth_token);
                        else await signInAnonymously(auth);
                    }
                });
                resolve({ db, appId, auth, doc, getDoc, setDoc, collection });
            } catch (e) { resolve(null); }
        });
    </script>
</head>
<body className="antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons ---
        const LucideIcon = ({ d, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d={d} />
            </svg>
        );
        const Sparkles = (props) => <LucideIcon {...props} d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />;
        const Gift = (props) => <LucideIcon {...props} d="M12 8v13M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5M3 8h18v4H3z" />;
        const Share2 = (props) => <LucideIcon {...props} d="M18 5a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM6 12a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM18 19a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM8.59 13.51l6.83 3.98M15.41 6.51l-6.82 3.98" />;
        const Info = (props) => <LucideIcon {...props} d="M12 16v-4M12 8h.01M22 12A10 10 0 1 1 12 2a10 10 0 0 1 10 10z" />;
        const CheckCircle = (props) => <LucideIcon {...props} d="M22 11.08V12a10 10 0 1 1-5.93-9.14M22 4 12 14.01l-3-3" />;

        // --- Data ---
        const DISCOUNTS = [
            { id: 'p1', text: '1 元驚喜價', weight: 1, desc: '鴻運當頭！超級大獎', note: '適用範圍限常態片單，不得截圖或轉讓他人使用' },
            { id: 'p2', text: '買一送一', weight: 24, desc: '好事成雙！喜事連連', note: '適用範圍限常態片單，不得截圖或轉讓他人使用' },
            { id: 'p3', text: '票價 30% OFF, weight: 75, desc: '票價 7 折超值優惠！', note: '適用範圍限常態片單，不得截圖或轉讓他人使用' }
        ];

        const FORTUNES = [
          { level: "大吉", type: "事業", title: "馬到成功", poem: ["千里駿馬遇伯樂", "鵬程萬里展宏圖", "貴人指引登高峰", "事業亨通步步高"], desc: "今年事業運勢如日中天，有晉升或創業的良機，勇往直前必有收穫。", icon: <Briefcase className="w-6 h-6" /> },
          { level: "大吉", type: "愛情", title: "天作之合", poem: ["良緣夙締喜相逢", "月老紅線緊相牽", "花好月圓人長久", "情深意重福滿門"], desc: "單身者將遇見真命天子/天女，有伴者感情甜蜜，適合談婚論嫁。", icon: <Heart className="w-6 h-6" /> },
          { level: "大吉", type: "家庭", title: "闔家安康", poem: ["瑞氣盈門福壽全", "子孫賢孝樂團圓", "家和萬事皆興旺", "喜氣洋洋過好年"], desc: "家庭氣氛和諧，長輩健康，晚輩乖巧，家中應有喜事發生。", icon: <Home className="w-6 h-6" /> },
          { level: "大吉", type: "財運", title: "財源廣進", poem: ["金銀財寶滾滾來", "投資理財眼光開", "正財偏財皆得意", "富貴榮華不需猜"], desc: "財星高照，無論是工作獎金或投資獲利都相當豐厚。", icon: <Coins className="w-6 h-6" /> },
          
          { level: "中吉", type: "事業", title: "穩步高升", poem: ["耕耘數載見花開", "雖然勞碌亦無災", "堅守崗位多努力", "功名利祿自然來"], desc: "工作表現穩定，雖有些許忙碌，但付出都能得到對等的回報。", icon: <Briefcase className="w-6 h-6" /> },
          { level: "中吉", type: "愛情", title: "心心相印", poem: ["即使偶有小風波", "雨過天晴情更多", "互相包容解心結", "琴瑟和鳴樂呵呵"], desc: "感情穩定發展，多溝通能化解小誤會，關係會更加緊密。", icon: <Heart className="w-6 h-6" /> },
          { level: "中吉", type: "家庭", title: "知足常樂", poem: ["平平安安即是福", "莫與他人比財祿", "且看庭前花開落", "家中自有黃金屋"], desc: "生活平順就是最大的福氣，珍惜與家人相處的時光。", icon: <Home className="w-6 h-6" /> },
          { level: "中吉", type: "財運", title: "積沙成塔", poem: ["小財源源不斷流", "節約開支不用愁", "聚沙成塔庫房滿", "穩健經營最優遊"], desc: "財運平穩，適合儲蓄與保守型投資，切勿貪圖暴利。", icon: <Coins className="w-6 h-6" /> },
          
          { level: "小吉", type: "事業", title: "蓄勢待發", poem: ["目前雖在低谷行", "莫灰心志莫停停", "待到春風吹柳綠", "一舉成名天下聞"], desc: "現在是累積實力的時期，保持耐心，機會即將到來。", icon: <Briefcase className="w-6 h-6" /> },
          { level: "小吉", type: "愛情", title: "細水長流", poem: ["緣分未到莫強求", "順其自然解千愁", "若是真心相待處", "春暖花開水長流"], desc: "感情進展較慢，不要急躁，慢慢培養感情會更長久。", icon: <Heart className="w-6 h-6" /> },
          { level: "小吉", type: "家庭", title: "和氣生財", poem: ["瑣碎家事莫計較", "退讓一步樂逍遙", "相互體諒多寬慰", "門庭吉慶喜眉梢"], desc: "家中瑣事較多，多一點包容與體諒，能避免不必要的口角。", icon: <Home className="w-6 h-6" /> },
          { level: "小吉", type: "財運", title: "小有所獲", poem: ["意外之財不可貪", "踏實工作心才安", "量入為出多算計", "自有餘糧在盤餐"], desc: "有些許偏財運，但主要還是靠正財，注意收支平衡。", icon: <Coins className="w-6 h-6" /> },
          
          { level: "末吉", type: "事業", title: "守成不易", poem: ["風浪之中舟難行", "且將帆落待天晴", "謹言慎行防小人", "守得雲開見月明"], desc: "職場風波較多，宜調行事，保守為上，等待時機好轉。", icon: <Briefcase className="w-6 h-6" /> },
          { level: "末吉", type: "愛情", title: "自愛自重", poem: ["落花有意水無情", "何必單戀一枝盈", "修身養性待良緣", "自有佳人伴君行"], desc: "目前緣分未到或有波折，先專注於提升自己，花若盛開蝴蝶自來。", icon: <Heart className="w-6 h-6" /> },
          { level: "末吉", type: "家庭", title: "除舊佈新", poem: ["舊習未除新運阻", "當思變通換門戶", "多行善事積陰德", "枯木逢春再發株"], desc: "家庭可能面臨一些變動或考驗，是改變壞習慣的好時機。", icon: <Home className="w-6 h-6" /> },
          { level: "末吉", type: "財運", title: "謹慎理財", poem: ["錢財身外莫強求", "投資失利令人憂", "安分守己勤耕作", "免得債務上心頭"], desc: "今年財運較弱，切忌借貸與高風險投資，保守儲蓄為上策。", icon: <Coins className="w-6 h-6" /> }
        ];

        function ParticleField() {
            const [particles, setParticles] = useState([]);
            useEffect(() => {
                const count = 15;
                const newParticles = Array.from({ length: count }).map((_, i) => ({
                    id: i,
                    left: `${Math.random() * 100}%`,
                    size: `${Math.random() * 5 + 2}px`,
                    delay: `${Math.random() * 5}s`,
                    duration: `${Math.random() * 3 + 4}s`
                }));
                setParticles(newParticles);
            }, []);
            return (
                <div className="fixed inset-0 pointer-events-none overflow-hidden z-0">
                    {particles.map(p => (
                        <div key={p.id} className="gold-particle" style={{
                            left: p.left,
                            width: p.size,
                            height: p.size,
                            animationDelay: p.delay,
                            animationDuration: p.duration
                        }} />
                    ))}
                </div>
            );
        }

        function App() {
          const [state, setState] = useState('START'); 
          const [fortune, setFortune] = useState(null);
          const [discount, setDiscount] = useState(null);
          const [isRedeemed, setIsRedeemed] = useState(false);
          const [showRules, setShowRules] = useState(false);
          const [isSharing, setIsSharing] = useState(false);
          const fortuneRef = useRef(null);
          
          const HERO_IMAGE_URL = "https://elenorechen.github.io/lunarnewyear.github.io/volare_newyearthumb.jpg"; 
          const BG_URL = "https://elenorechen.github.io/lunarnewyear.github.io/04.jpg";

          useEffect(() => {
            const localData = localStorage.getItem('2026_fortune_record_v2');
            if (localData) {
                const record = JSON.parse(localData);
                setFortune(FORTUNES[record.fortuneIndex]);
                setDiscount(record.discount);
                setIsRedeemed(record.isRedeemed);
                setState('RESULT');
            }
          }, []);

          const drawFortune = () => {
            setState('ANIMATING');
            setTimeout(() => {
              const fIdx = Math.floor(Math.random() * FORTUNES.length);
              // Weighted draw
              const totalWeight = DISCOUNTS.reduce((s, i) => s + i.weight, 0);
              let r = Math.random() * totalWeight;
              let d = DISCOUNTS[DISCOUNTS.length - 1];
              for (const item of DISCOUNTS) {
                  if (r < item.weight) { d = item; break; }
                  r -= item.weight;
              }
              
              setFortune(FORTUNES[fIdx]);
              setDiscount(d);
              setIsRedeemed(false);
              localStorage.setItem('2026_fortune_record_v2', JSON.stringify({
                  fortuneIndex: fIdx,
                  discount: d,
                  isRedeemed: false,
                  timestamp: new Date().toISOString()
              }));
              setState('RESULT');
            }, 2500);
          };

          const handleRedeem = () => {
              if (window.confirm("是否確定要核銷？\n[為保障您的權益，請交由工作人員確認]")) {
                  setIsRedeemed(true);
                  const record = JSON.parse(localStorage.getItem('2026_fortune_record_v2'));
                  record.isRedeemed = true;
                  localStorage.setItem('2026_fortune_record_v2', JSON.stringify(record));
              }
          };

          const handleShare = async () => {
            if (isSharing) return;
            setIsSharing(true);
            try {
                const canvas = await html2canvas(fortuneRef.current, {
                    scale: 2,
                    backgroundColor: '#FFFDF5',
                    useCORS: true
                });
                const blob = await new Promise(r => canvas.toBlob(r, 'image/png'));
                const file = new File([blob], "fortune.png", { type: "image/png" });
                
                if (navigator.share && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: 'VOLARE 2026 開運靈籤',
                        text: `我抽到了：${discount.text}！你也來試試手氣吧！`
                    });
                } else {
                    const link = document.createElement('a');
                    link.download = 'volare_fortune.png';
                    link.href = canvas.toDataURL();
                    link.click();
                }
            } catch (e) { console.error(e); }
            setIsSharing(false);
          };

          return (
            <div className="min-h-screen bg-[#8B0000] flex flex-col items-center relative overflow-x-hidden">
              <ParticleField />
              
              {/* 背景圖案 */}
              <div className="absolute inset-0 opacity-10 pointer-events-none z-0">
                  <img src={BG_URL} className="w-full h-full object-cover" />
              </div>

              {/* 固定標題/主視覺 */}
              <header className={`w-full max-w-lg transition-all duration-700 z-10 ${state === 'RESULT' ? 'mt-4' : 'mt-8 md:mt-12'}`}>
                  <div className="px-6">
                    <img 
                        src={HERO_IMAGE_URL} 
                        alt="VOLARE 2026" 
                        className={`w-full h-auto rounded-xl shadow-2xl border-2 border-yellow-500/50 transition-transform ${state === 'RESULT' ? 'scale-90' : 'scale-100'}`} 
                    />
                  </div>
              </header>

              {/* 主要互動區域 */}
              <main className="flex-1 w-full max-w-md flex flex-col items-center justify-start py-8 px-4 z-10">
                
                {state === 'START' && (
                  <div className="flex flex-col items-center animate-fade-in-up">
                    <div className="relative mb-12 group cursor-pointer" onClick={drawFortune}>
                        {/* 籤桶視覺優化 */}
                        <div className="w-48 h-72 relative">
                            {/* 籤桶本體 */}
                            <div className="absolute inset-0 bg-gradient-to-b from-red-700 via-red-800 to-black rounded-t-lg rounded-b-[40px] border-4 border-yellow-500 shadow-[0_20px_50px_rgba(0,0,0,0.5)] overflow-hidden">
                                {/* 裝飾雲紋 */}
                                <div className="absolute top-4 left-0 w-full h-8 opacity-30 border-y border-yellow-400"></div>
                                <div className="absolute bottom-12 left-1/2 -translate-x-1/2 w-20 h-20 border-2 border-yellow-500 rotate-45 flex items-center justify-center">
                                    <span className="text-yellow-400 font-black text-4xl -rotate-45">靈</span>
                                </div>
                            </div>
                            {/* 籤支 */}
                            <div className="absolute -top-12 left-1/2 -translate-x-1/2 flex gap-1 items-end">
                                <div className="w-2.5 h-20 bg-[#f3e5ab] border border-yellow-800 rounded-t transform -rotate-12"></div>
                                <div className="w-2.5 h-24 bg-[#f3e5ab] border border-yellow-800 rounded-t transform -rotate-3 z-10"></div>
                                <div className="w-2.5 h-22 bg-[#f3e5ab] border border-yellow-800 rounded-t transform rotate-6"></div>
                            </div>
                        </div>
                        
                        <div className="mt-8 px-10 py-4 bg-gradient-to-r from-yellow-400 via-yellow-200 to-yellow-600 text-red-900 font-black text-2xl rounded-full shadow-[0_0_20px_rgba(255,215,0,0.5)] hover:scale-105 active:scale-95 transition-all flex items-center gap-3 border-2 border-white">
                            <Sparkles className="w-6 h-6 animate-pulse" />
                            立即求籤
                            <Sparkles className="w-6 h-6 animate-pulse" />
                        </div>
                    </div>
                  </div>
                )}

                {state === 'ANIMATING' && (
                  <div className="flex flex-col items-center justify-center pt-20">
                    <div className="animate-shake w-48 h-72 bg-gradient-to-b from-red-700 to-black rounded-t-lg rounded-b-[40px] border-4 border-yellow-500 relative shadow-2xl">
                         <div className="absolute -top-16 left-1/2 -translate-x-1/2 flex gap-1 items-end animate-bounce">
                                <div className="w-3 h-24 bg-[#f3e5ab] border border-yellow-800 rounded-t"></div>
                                <div className="w-3 h-28 bg-[#f3e5ab] border border-yellow-800 rounded-t"></div>
                                <div className="w-3 h-24 bg-[#f3e5ab] border border-yellow-800 rounded-t"></div>
                         </div>
                         <div className="absolute inset-0 flex items-center justify-center">
                            <span className="text-yellow-400 font-black text-5xl opacity-20">運</span>
                         </div>
                    </div>
                    <p className="mt-12 text-yellow-300 text-2xl font-black tracking-widest animate-pulse">誠心祈求中...</p>
                  </div>
                )}

                {state === 'RESULT' && fortune && (
                  <div className="animate-fade-in-up w-full">
                    {/* 籤詩卡片 */}
                    <div ref={fortuneRef} className="bg-[#FFFDF5] rounded-xl shadow-2xl border-[12px] border-double border-red-800 overflow-hidden relative">
                        {/* 內嵌主視覺浮水印 */}
                        <div className="absolute top-0 left-0 w-full h-full opacity-[0.03] pointer-events-none">
                            <img src={HERO_IMAGE_URL} className="w-full h-full object-cover" />
                        </div>

                        <div className="p-6 flex flex-col items-center">
                            {/* 運勢印章 */}
                            <div className="mb-6 relative">
                                <div className="w-20 h-20 border-4 border-red-700 rounded-lg flex items-center justify-center bg-white shadow-inner">
                                    <span className="text-red-700 font-black text-4xl seal-font">{fortune.level}</span>
                                </div>
                                <div className="absolute -right-4 -bottom-4 bg-yellow-500 text-red-900 px-2 py-0.5 text-xs font-bold rounded transform rotate-12 border border-red-800">
                                    {fortune.type}
                                </div>
                            </div>

                            <h2 className="text-3xl font-black text-gray-900 mb-8 tracking-[0.3em] border-b-2 border-red-800 pb-2">{fortune.title}</h2>

                            <div className="space-y-4 mb-8">
                                {fortune.poem.map((line, idx) => (
                                    <p key={idx} className="text-xl font-bold text-gray-800 tracking-widest text-center">{line}</p>
                                ))}
                            </div>

                            <div className="w-full bg-red-50 p-4 rounded-lg border-l-4 border-red-700 mb-6">
                                <p className="text-red-900 leading-relaxed text-sm">
                                    <span className="font-black bg-red-700 text-white px-2 py-0.5 mr-2 rounded">解曰</span>
                                    {fortune.desc}
                                </p>
                            </div>

                            {/* 加強後的獎項區 */}
                            {discount && (
                                <div className={`w-full relative transition-all ${isRedeemed ? 'opacity-50 grayscale' : ''}`}>
                                    <div className="absolute -inset-1 bg-gradient-to-r from-yellow-600 via-yellow-300 to-yellow-600 rounded-xl blur opacity-30 animate-pulse"></div>
                                    <div className={`relative bg-gradient-to-r from-red-600 to-red-800 text-white p-4 rounded-xl shadow-xl border-2 border-yellow-400 ${!isRedeemed ? 'animate-shine' : ''}`}>
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="bg-yellow-400 p-2 rounded-full text-red-800 shadow-md">
                                                    <Gift className="w-6 h-6" />
                                                </div>
                                                <div>
                                                    <p className="text-[10px] font-bold text-yellow-300 uppercase tracking-tighter">New Year Special</p>
                                                    <h3 className="text-2xl font-black text-white">{discount.text}</h3>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                {isRedeemed ? (
                                                    <div className="bg-gray-800/50 px-3 py-1 rounded text-xs font-bold flex items-center gap-1">
                                                        <CheckCircle className="w-3 h-3" /> 已核銷
                                                    </div>
                                                ) : (
                                                    <button 
                                                        onClick={handleRedeem}
                                                        className="bg-yellow-400 text-red-900 px-3 py-1.5 rounded-lg text-xs font-black shadow-lg hover:bg-white active:scale-95 transition-all"
                                                    >
                                                        核銷點我
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                        <div className="mt-2 text-[10px] text-yellow-200/80 border-t border-white/20 pt-2 flex justify-between">
                                            <span>期限: 2026/03/01</span>
                                            <span>{discount.note}</span>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* 操作按鈕 */}
                    <div className="mt-8 flex gap-3">
                        <button 
                            onClick={handleShare}
                            disabled={isSharing}
                            className="flex-1 bg-gradient-to-r from-yellow-500 to-yellow-600 text-red-900 font-black py-4 rounded-xl shadow-xl flex items-center justify-center gap-2 hover:scale-[1.02] active:scale-95 transition-all border-b-4 border-yellow-800 disabled:opacity-50"
                        >
                            <Share2 className="w-6 h-6" />
                            {isSharing ? '圖片生成中...' : '分享好運氣'}
                        </button>
                    </div>

                    {/* 底部說明 */}
                    <div className="mt-8 bg-black/20 backdrop-blur-md rounded-xl p-6 border border-yellow-500/30">
                        <h4 className="text-yellow-400 font-black mb-3 flex items-center gap-2">
                            <Info className="w-5 h-5" /> 活動須知
                        </h4>
                        <ul className="text-white/80 text-xs space-y-2 list-decimal list-inside pl-1">
                            <li>本活動優惠僅限現場核銷使用，請由工作人員操作，自行點擊核銷或截圖皆視為無效。</li>
                            <li>每人限參加乙次，優惠券限 2026/3/1 前使用有效。</li>
                            <li>優惠不得與其他折扣併用，亦不得要求折現或更換其他商品。</li>
                            <li>VOLARE 行動飛行劇院保有最終解釋權。</li>
                        </ul>
                    </div>
                  </div>
                )}
              </main>

              {/* 頁尾 */}
              <footer className="w-full text-center py-8 z-10">
                   {state === 'START' && (
                        <button onClick={() => setShowRules(true)} className="text-yellow-500/60 text-xs underline mb-4">
                            完整活動細則
                        </button>
                   )}
                   <div className="text-yellow-600/40 text-[10px] tracking-widest">
                        © 2026 VOLARE 行動飛行劇院丙午年春節限定 · ALL RIGHTS RESERVED
                   </div>
              </footer>

              {/* 規則彈窗 */}
              {showRules && (
                  <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm animate-fade-in" onClick={() => setShowRules(false)}>
                      <div className="bg-white rounded-2xl w-full max-w-sm overflow-hidden border-4 border-red-800" onClick={e => e.stopPropagation()}>
                          <div className="bg-red-800 p-4 text-yellow-400 font-black text-center text-xl">
                              2026 新春開運指南
                          </div>
                          <div className="p-6 text-gray-700 text-sm leading-relaxed space-y-3">
                             <p>本活動優惠僅限現場核銷使用，請由工作人員操作，自行點擊核銷或截圖皆視為無效。</p>
                             <p>每人限參加一次，優惠券限 2026/3/1 前使用有效。請在結帳前出示畫面給工作人員。</p>
                             <p>優惠不得與其他折扣併用，亦不得要求折現或更換其他商品。</p>
                             <p>贈品數量有限，送完為止，主辦單位保留更換等值贈品之權利。</p>
                          </div>
                          <button onClick={() => setShowRules(false)} className="w-full bg-gray-100 py-4 font-bold text-gray-500 hover:bg-gray-200 transition-colors">
                              關閉視窗
                          </button>
                      </div>
                  </div>
              )}
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>