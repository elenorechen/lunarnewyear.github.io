<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VOLARE 行動飛行劇院｜2026 好運籤詩馬上到</title>
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="VOLARE 行動飛行劇院｜好運籤詩馬上到">
    <meta property="og:description" content="天馬行空飛高高，好運籤詩馬上到！快來抽取您的 2026 年專屬運勢籤詩！">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://elenorechen.github.io/lunarnewyear.github.io/volare_newyearthumb.jpg">

    <!-- Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Serif TC', serif;
            background-color: #8B0000;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        /* 閃爍動畫 */
        @keyframes shine {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        .animate-shine {
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
            background-size: 200% 100%;
            animation: shine 2s infinite;
        }

        /* 籤桶晃動 */
        @keyframes shake {
          0% { transform: rotate(0deg); }
          20% { transform: rotate(-10deg); }
          40% { transform: rotate(10deg); }
          60% { transform: rotate(-10deg); }
          80% { transform: rotate(10deg); }
          100% { transform: rotate(0deg); }
        }
        .animate-shake {
          animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) infinite;
        }

        /* 漸變進入 */
        @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
          animation: fadeInUp 0.6s ease-out forwards;
        }

        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        .animate-fade-in {
          animation: fadeIn 0.4s ease-out forwards;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* 蓋章效果 */
        .stamp-text {
            writing-mode: vertical-rl;
            text-orientation: upright;
        }
    </style>

    <!-- Firebase SDK Logic -->
    <script type="module">
        import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

        const GLOBAL_FB_KEY = '__2026_FORTUNE_FB_PROMISE_V10__';
        window[GLOBAL_FB_KEY] = new Promise(async (resolve) => {
            if (!window.__firebase_config) { resolve(null); return; }
            try {
                const config = JSON.parse(window.__firebase_config);
                const app = getApps().length === 0 ? initializeApp(config) : getApps()[0];
                const auth = getAuth(app);
                const db = getFirestore(app);
                const appId = window.__app_id || 'default-app-id';
                onAuthStateChanged(auth, async (user) => {
                    if (!user) {
                        if (window.__initial_auth_token) await signInWithCustomToken(auth, window.__initial_auth_token);
                        else await signInAnonymously(auth);
                    }
                });
                resolve({ db, appId, auth, doc, getDoc, setDoc, collection });
            } catch (e) { resolve(null); }
        });
    </script>
</head>
<body class="antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons ---
        const LucideIcon = ({ d, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d={d} />
            </svg>
        );
        const Briefcase = (props) => <LucideIcon {...props} d="M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16M2 8h20v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8zM12 12h.01" />;
        const Heart = (props) => <LucideIcon {...props} d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />;
        const Home = (props) => <LucideIcon {...props} d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />;
        const Coins = (props) => <LucideIcon {...props} d="M8 6h8M8 10h8M8 14h8M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />;
        const Share2 = (props) => <LucideIcon {...props} d="M18 5a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM6 12a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM18 19a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM8.59 13.51l6.83 3.98M15.41 6.51l-6.82 3.98" />;
        const Info = (props) => <LucideIcon {...props} d="M12 16v-4M12 8h.01M22 12A10 10 0 1 1 12 2a10 10 0 0 1 10 10z" />;
        const CheckCircle = (props) => <LucideIcon {...props} d="M22 11.08V12a10 10 0 1 1-5.93-9.14M22 4 12 14.01l-3-3" />;
        const Globe = (props) => <LucideIcon {...props} d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8zM4.26 9.45a9.8 9.8 0 0 1 15.48 0M4.26 14.55a9.8 9.8 0 0 0 15.48 0M12 2v20M2 12h20" />;

        // --- Translations ---
        const TRANSLATIONS = {
            'zh-TW': {
                lang: 'English',
                title: '立即求籤',
                animating: '誠心祈求中...',
                share: '分享好運連結',
                redeem: '核銷點我',
                redeemed: '已核銷',
                ruleBtn: '完整活動細則',
                rulesTitle: '2026 新春開運指南',
                rules: [
                    '1. 本活動優惠僅限現場核銷使用，請由工作人員操作。',
                    '2. 每人限參加一次，期限至 2026/03/01。',
                    '3. 優惠不得要求折現或更換其他商品。',
                    '4. 贈品數量有限，送完為止。'
                ],
                noticeTitle: '活動須知',
                notice: [
                    '優惠僅限現場核銷使用，由工作人員點擊，自行核銷無效。',
                    '每人限參加一次，優惠限 2026/3/1 前有效。',
                    '不得與其他折扣併用或折換現金。',
                    'VOLARE 行動飛行劇院保有最終解釋權。'
                ],
                redeemConfirmTitle: '核銷確認',
                redeemConfirmMsg: '是否確定要核銷？',
                redeemConfirmSub: '為保障您的權益，請務必交由工作人員現場點擊',
                confirm: '確定核銷',
                cancel: '取消',
                close: '關閉視窗',
                copyToast: '已複製運勢連結至剪貼簿！',
                exp: '限 2026/3/1 前使用完畢',
                interpretation: '解曰',
                footer: '© 2026 VOLARE 行動飛行劇院丙午年限定',
                discounts: [
                    { id: 'p1', text: '1 元驚喜價 & 周邊商品九折', note: '限本人購買常態片單全票使用，截圖無效' },
                    { id: 'p2', text: '買一送一 & 周邊商品九折', note: '限本人購買常態片單全票使用，截圖無效' },
                    { id: 'p3', text: '常態片票價七折 & 周邊商品九折', note: '限本人購買常態片單全票使用，截圖無效' }
                ],
                fortunes: [
                  { level: "大吉", type: "事業", title: "馬到成功", poem: ["千里駿馬遇伯樂", "鵬程萬里展宏圖", "貴人指引登高峰", "事業亨通步步高"], desc: "今年事業運勢如日中天，有晉升或創業的良機，勇往直前必有收穫。" },
                  { level: "大吉", type: "愛情", title: "天作之合", poem: ["良緣夙締喜相逢", "月老紅線緊相牽", "花好月圓人長久", "情深意重福滿門"], desc: "單身者將遇見真命天子，有伴者感情甜蜜，適合談婚論嫁。" },
                  { level: "大吉", type: "家庭", title: "闔家安康", poem: ["瑞氣盈門福壽全", "子孫賢孝樂團圓", "家和萬事皆興旺", "喜氣洋洋過好年"], desc: "家庭氣氛和諧，長輩健康，晚輩乖巧，家中應有喜事發生。" },
                  { level: "大吉", type: "財運", title: "財源廣進", poem: ["金銀財寶滾滾來", "投資理財眼光開", "正財偏財皆得意", "富貴榮華不需猜"], desc: "財星高照，無論是工作獎金或投資獲利都相當豐厚。" },
                  { level: "中吉", type: "事業", title: "穩步高升", poem: ["耕耘數載見花開", "雖然勞碌亦無災", "堅守崗位多努力", "功名利祿自然來"], desc: "工作表現穩定，雖有些許忙碌，但付出都能得到對等的回報。" },
                  { level: "中吉", type: "愛情", title: "心心相印", poem: ["即使偶有小風波", "雨過天晴情更多", "互相包容解心結", "琴瑟和鳴樂呵呵"], desc: "感情穩定發展，多溝通能化解小誤會，關係會更加緊密。" },
                  { level: "中吉", type: "家庭", title: "知足常樂", poem: ["平平安安即是福", "莫與他人比財祿", "且看庭前花開落", "家中自有黃金屋"], desc: "生活平順就是最大的福氣，珍惜與家人相處的時光。" },
                  { level: "中吉", type: "財運", title: "積沙成塔", poem: ["小財源源不斷流", "節約開支不用愁", "聚沙成塔庫房滿", "穩健經營最優遊"], desc: "財運平穩，適合儲蓄與保守型投資，切勿貪圖暴利。" },
                  { level: "小吉", type: "事業", title: "蓄勢待發", poem: ["目前雖在低谷行", "莫灰心志莫停停", "待到春風吹柳綠", "一舉成名天下聞"], desc: "現在是累積實力的時期，保持耐心，機會即將到來。" },
                  { level: "小吉", type: "愛情", title: "細水長流", poem: ["緣分未到莫強求", "順其自然解千愁", "若是真心相待處", "春暖花開水長流"], desc: "感情進展較慢，不要急躁，慢慢培養感情會更長久。" },
                  { level: "小吉", type: "家庭", title: "和氣生財", poem: ["瑣碎家事莫計較", "退讓一步樂逍遙", "相互體諒多寬慰", "門庭吉慶喜眉梢"], desc: "家中瑣事較多，多一點包容與體諒，能避免不必要的口角。" },
                  { level: "小吉", type: "財運", title: "小有所獲", poem: ["意外之財不可貪", "踏實工作心才安", "量入為出多算計", "自有餘糧在盤餐"], desc: "有些許偏財運，但主要還是靠正財，注意收支平衡。" }
                ]
            },
            'en-US': {
                lang: '繁體中文',
                title: 'Draw Fortune',
                animating: 'Praying sincerely...',
                share: 'Share Link',
                redeem: 'Redeem',
                redeemed: 'Used',
                ruleBtn: 'Terms & Conditions',
                rulesTitle: '2026 New Year Guide',
                rules: [
                    '1. This offer is valid only for on-site redemption by staff.',
                    '2. Limited to one draw per person, valid until 2026/03/01.',
                    '3. Cannot be exchanged for cash or other goods.',
                    '4. Gift supplies are limited while stocks last.'
                ],
                noticeTitle: 'Notice',
                notice: [
                    'Redemption must be processed by on-site staff. Screenshots are invalid.',
                    'Limit one draw per person. Valid until 2026/03/01.',
                    'Cannot be combined with other discounts or cash.',
                    'VOLARE Mobile Flying Theater reserves the right of final interpretation.'
                ],
                redeemConfirmTitle: 'Redeem Confirmation',
                redeemConfirmMsg: 'Are you sure you want to redeem?',
                redeemConfirmSub: 'To protect your rights, this must be clicked by an on-site staff member.',
                confirm: 'Confirm',
                cancel: 'Cancel',
                close: 'Close',
                copyToast: 'Link copied to clipboard!',
                exp: 'Valid through 2026/3/1',
                interpretation: 'Interpretation',
                footer: '© 2026 VOLARE Mobile Flying Theater Ltd.',
                discounts: [
                    { id: 'p1', text: 'Special $1 Price, 10% OFF Merch', note: 'Valid for full-price tickets only. Screenshots are invalid.' },
                    { id: 'p2', text: 'Buy One Get One Free, 10% OFF Merch', note: 'Valid for full-price tickets only. Screenshots are invalid.' },
                    { id: 'p3', text: '30% OFF Ticket on Regular Titles, 10% OFF Merch', note: 'Valid for full-price tickets only. Screenshots are invalid.' }
                ],
                fortunes: [
                  { level: "大吉", type: "Career", title: "Swift Success", poem: ["A noble horse meets its guide", "The eagle spreads wings wide", "A mountain reached with grace", "Rising high in every place"], desc: "Your career is soaring. Seize promotion or startup opportunities; success awaits." },
                  { level: "大吉", type: "Love", title: "Perfect Match", poem: ["Destined souls finally meet", "Moonlight makes the bond sweet", "Flowers bloom in harmony", "Love grows for eternity"], desc: "Singles will meet their soulmate. Couples may consider marriage or deep commitments." },
                  { level: "大吉", type: "Family", title: "Peaceful Home", poem: ["Blessings fill the morning air", "Harmony found everywhere", "Prosperity starts within", "Let the joy and luck begin"], desc: "Excellent domestic harmony. Health and happiness will grace every family member." },
                  { level: "大吉", type: "Wealth", title: "Golden Stream", poem: ["Wealth flows like a river deep", "Good returns for what you keep", "Fortune shines on every side", "Ride the prosperous high tide"], desc: "Abundant financial luck. Expect bonuses, successful investments, or unexpected gains." },
                  { level: "中吉", type: "Career", title: "Steady Rise", poem: ["Hard work yields a fruitful field", "A steady hand, a sturdy shield", "Persistence brings the prize", "Watch your reputation rise"], desc: "Stable performance. Your dedication is recognized, and rewards will follow naturally." },
                  { level: "中吉", type: "Love", title: "Heart to Heart", poem: ["Small waves may briefly toss", "But love knows no true loss", "Patience mends the slight", "Love shines ever so bright"], desc: "Stable relationships. Clear communication will resolve minor issues and strengthen bonds." },
                  { level: "中吉", type: "Family", title: "True Content", poem: ["Safety is the greatest treasure", "Joy found in simple measure", "Home is where the heart finds rest", "In every way you are blessed"], desc: "Life is peaceful. Cherish the time spent with family; simplicity brings the most joy." },
                  { level: "中吉", type: "Wealth", title: "Small Gains", poem: ["Streams gather to the sea", "Wise with what you let be", "Little bits turn into more", "Wealth stands at your door"], desc: "Steady wealth. Focus on savings and conservative investments; avoid reckless risks." },
                  { level: "小吉", type: "Career", title: "Patient Seed", poem: ["Though the valley feels so low", "Wait for the spring winds to blow", "Accumulate strength and light", "Soon your future will be bright"], desc: "A period of growth. Be patient and build your skills; the right timing is coming." },
                  { level: "小吉", type: "Love", title: "Gentle Flow", poem: ["Do not force what is not due", "Let fate bring the right to you", "Flowers bloom when time is right", "Keep your spirit calm and light"], desc: "Slow progress in love. Stay natural and do not rush; meaningful bonds take time." },
                  { level: "小吉", type: "Family", title: "Kind Words", poem: ["Small disputes are best ignored", "Peace and quiet are restored", "Forgive the minor things", "See the joy that kindness brings"], desc: "Minor chores may arise. Practice tolerance and patience to keep the home happy." },
                  { level: "小吉", type: "Wealth", title: "Balanced Path", poem: ["Do not crave for easy gold", "Keep your steady, honest hold", "Balance what you give and take", "Safe the fortune you will make"], desc: "Minor windfalls possible. Rely on your primary income and maintain a balanced budget." }
                ]
            }
        };

        function App() {
          const [lang, setLang] = useState('zh-TW');
          const [state, setState] = useState('START'); 
          const [fortune, setFortune] = useState(null);
          const [discount, setDiscount] = useState(null);
          const [isRedeemed, setIsRedeemed] = useState(false);
          const [showRules, setShowRules] = useState(false);
          const [showRedeemConfirm, setShowRedeemConfirm] = useState(false);
          const [showCopyToast, setShowCopyToast] = useState(false);
          const fortuneRef = useRef(null);
          
          const t = TRANSLATIONS[lang];
          const HERO_IMAGE_URL = "https://elenorechen.github.io/lunarnewyear.github.io/volare_newyearthumb.jpg"; 
          const BG_URL = "https://elenorechen.github.io/lunarnewyear.github.io/04.jpg";

          useEffect(() => {
            try {
                const localData = localStorage.getItem('2026_fortune_record_v2');
                if (localData) {
                    const record = JSON.parse(localData);
                    // 這裡儲存索引，顯示時根據目前語言對應
                    const fIdx = record.fortuneIndex;
                    const dIdx = record.discountIndex; // 我們改存 index 以應對語系切換

                    if (TRANSLATIONS['zh-TW'].fortunes[fIdx]) {
                        setFortune(fIdx);
                        setDiscount(dIdx !== undefined ? dIdx : 2); // 預設為票價 30% OFF
                        setIsRedeemed(record.isRedeemed || false);
                        setState('RESULT');
                    }
                }
            } catch (e) { console.error("Storage load error", e); }
          }, []);

          const drawFortune = () => {
            setState('ANIMATING');
            setTimeout(() => {
              const fIdx = Math.floor(Math.random() * TRANSLATIONS['zh-TW'].fortunes.length);
              
              // 權重抽獎邏輯
              const weights = [1, 24, 75]; //對應 p1, p2, p3
              const totalWeight = weights.reduce((s, w) => s + w, 0);
              let r = Math.random() * totalWeight;
              let dIdx = 2;
              for (let i = 0; i < weights.length; i++) {
                  if (r < weights[i]) { dIdx = i; break; }
                  r -= weights[i];
              }
              
              setFortune(fIdx);
              setDiscount(dIdx);
              setIsRedeemed(false);
              localStorage.setItem('2026_fortune_record_v2', JSON.stringify({
                  fortuneIndex: fIdx, discountIndex: dIdx, isRedeemed: false, timestamp: new Date().toISOString()
              }));
              setState('RESULT');
            }, 2000);
          };

          const executeRedeem = () => {
              setIsRedeemed(true);
              const localData = localStorage.getItem('2026_fortune_record_v2');
              if (localData) {
                  const record = JSON.parse(localData);
                  record.isRedeemed = true;
                  localStorage.setItem('2026_fortune_record_v2', JSON.stringify(record));
              }
              setShowRedeemConfirm(false);
          };

          const handleShare = async () => {
            const currentFortune = t.fortunes[fortune];
            const currentDiscount = t.discounts[discount];
            const shareText = `【VOLARE 2026】\nMy fortune: ${currentFortune.title} (${currentFortune.level})!\nWon: ${currentDiscount.text}!\nDraw your exclusive 2026 fortune here:\n${window.location.href}`;
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'VOLARE 2026',
                        text: shareText,
                        url: window.location.href
                    });
                } catch (e) { copyToClipboard(shareText); }
            } else { copyToClipboard(shareText); }
          };

          const copyToClipboard = (text) => {
              const textArea = document.createElement("textarea");
              textArea.value = text;
              document.body.appendChild(textArea);
              textArea.select();
              try {
                  document.execCommand('copy');
                  setShowCopyToast(true);
                  setTimeout(() => setShowCopyToast(false), 2000);
              } catch (err) { console.error('Copy failed', err); }
              document.body.removeChild(textArea);
          };

          const toggleLang = () => {
              setLang(prev => prev === 'zh-TW' ? 'en-US' : 'zh-TW');
          };

          const currentFortuneData = fortune !== null ? t.fortunes[fortune] : null;
          const currentDiscountData = discount !== null ? t.discounts[discount] : null;

          return (
            <div className="min-h-screen bg-[#8B0000] flex flex-col items-center relative overflow-x-hidden">
              <div className="absolute inset-0 opacity-10 pointer-events-none z-0">
                  <img src={BG_URL} className="w-full h-full object-cover" alt="bg" />
              </div>

              {/* 語系切換按鈕 */}
              <button 
                onClick={toggleLang}
                className="fixed top-4 right-4 z-[50] bg-white/20 backdrop-blur-md border border-white/30 text-white px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-2 hover:bg-white/40 transition-all active:scale-95"
              >
                <Globe className="w-3.5 h-3.5" />
                {t.lang}
              </button>

              <header className={`w-full max-w-lg transition-all duration-700 z-10 ${state === 'RESULT' ? 'mt-4' : 'mt-8 md:mt-12'}`}>
                  <div className="px-6 flex justify-center">
                    <img src={HERO_IMAGE_URL} alt="VOLARE 2026" className={`w-full h-auto rounded-xl shadow-2xl border-2 border-yellow-500/50 transition-transform ${state === 'RESULT' ? 'scale-90' : 'scale-100'}`} />
                  </div>
              </header>

              <main className="flex-1 w-full max-w-md flex flex-col items-center justify-start py-8 px-4 z-10">
                
                {state === 'START' && (
                  <div className="w-full flex flex-col items-center animate-fade-in-up pt-12">
                    <div className="relative mb-12 flex flex-col items-center group cursor-pointer" onClick={drawFortune}>
                        <div className="w-48 h-72 relative mb-8">
                            <div className="absolute inset-0 bg-gradient-to-b from-red-700 via-red-800 to-black rounded-t-lg rounded-b-[40px] border-4 border-yellow-500 shadow-[0_20px_50px_rgba(0,0,0,0.5)] overflow-hidden">
                                <div className="absolute top-4 left-0 w-full h-8 opacity-30 border-y border-yellow-400"></div>
                                <div className="absolute bottom-12 left-1/2 -translate-x-1/2 w-20 h-20 border-2 border-yellow-500 rotate-45 flex items-center justify-center">
                                    <span className="text-yellow-400 font-black text-4xl -rotate-45">{lang === 'zh-TW' ? '靈' : 'ZEN'}</span>
                                </div>
                            </div>
                            <div className="absolute -top-12 left-1/2 -translate-x-1/2 flex gap-1 items-end">
                                <div className="w-2.5 h-20 bg-[#f3e5ab] border border-yellow-800 rounded-t transform -rotate-12"></div>
                                <div className="w-2.5 h-24 bg-[#f3e5ab] border border-yellow-800 rounded-t transform -rotate-3 z-10"></div>
                                <div className="w-2.5 h-22 bg-[#f3e5ab] border border-yellow-800 rounded-t transform rotate-6"></div>
                            </div>
                        </div>
                        
                        <button className="px-10 py-4 bg-gradient-to-r from-yellow-400 via-yellow-200 to-yellow-600 text-red-900 font-black text-2xl rounded-full shadow-[0_0_20px_rgba(255,215,0,0.5)] hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-3 border-2 border-white w-full max-w-[280px]">
                            {t.title}
                        </button>
                    </div>
                  </div>
                )}

                {state === 'ANIMATING' && (
                  <div className="flex flex-col items-center justify-center pt-24 animate-fade-in">
                    <div className="animate-shake w-48 h-72 bg-gradient-to-b from-red-700 to-black rounded-t-lg rounded-b-[40px] border-4 border-yellow-500 relative shadow-2xl">
                         <div className="absolute -top-16 left-1/2 -translate-x-1/2 flex gap-1 items-end animate-bounce">
                                <div className="w-3 h-24 bg-[#f3e5ab] border border-yellow-800 rounded-t"></div>
                                <div className="w-3 h-28 bg-[#f3e5ab] border border-yellow-800 rounded-t"></div>
                                <div className="w-3 h-24 bg-[#f3e5ab] border border-yellow-800 rounded-t"></div>
                         </div>
                    </div>
                    <p className="mt-12 text-yellow-300 text-2xl font-black tracking-widest animate-pulse">{t.animating}</p>
                  </div>
                )}

                {state === 'RESULT' && currentFortuneData && (
                  <div className="animate-fade-in-up w-full">
                    <div ref={fortuneRef} className="bg-[#FFFDF5] rounded-xl shadow-2xl border-[12px] border-double border-red-800 overflow-hidden relative">
                        <div className="p-6 flex flex-col items-center relative z-10">
                            {/* 運勢印章 */}
                            <div className="mb-6 mt-4 relative">
                                <div className="min-w-[5rem] px-2 h-28 border-4 border-red-700 rounded-lg flex flex-col items-center justify-center bg-white shadow-inner py-2">
                                    <span className={`text-red-700 font-black leading-none ${lang === 'zh-TW' ? 'text-4xl stamp-text' : 'text-xl uppercase text-center'}`}>
                                        {currentFortuneData.level}
                                    </span>
                                </div>
                                <div className="absolute -right-4 -bottom-2 bg-yellow-500 text-red-900 px-2 py-0.5 text-xs font-bold rounded transform rotate-12 border border-red-800">
                                    {currentFortuneData.type}
                                </div>
                            </div>

                            <h2 className={`font-black text-gray-900 mb-8 border-b-2 border-red-800 pb-2 text-center ${lang === 'zh-TW' ? 'text-3xl tracking-[0.3em]' : 'text-xl tracking-wider uppercase'}`}>
                                {currentFortuneData.title}
                            </h2>

                            <div className="space-y-4 mb-8">
                                {currentFortuneData.poem.map((line, idx) => (
                                    <p key={idx} className="text-xl font-bold text-gray-800 tracking-widest text-center">{line}</p>
                                ))}
                            </div>

                            <div className="w-full bg-red-50 p-4 rounded-lg border-l-4 border-red-700 mb-6">
                                <p className="text-red-900 leading-relaxed text-sm">
                                    <span className="font-black bg-red-700 text-white px-2 py-0.5 mr-2 rounded">{t.interpretation}</span>
                                    {currentFortuneData.desc}
                                </p>
                            </div>

                            {currentDiscountData && (
                                <div className={`w-full relative transition-all ${isRedeemed ? 'opacity-50 grayscale' : ''}`}>
                                    <div className="absolute -inset-1 bg-gradient-to-r from-yellow-600 via-yellow-300 to-yellow-600 rounded-xl blur opacity-30 animate-pulse"></div>
                                    <div className={`relative bg-gradient-to-r from-red-600 to-red-800 text-white p-4 rounded-xl shadow-xl border-2 border-yellow-400 ${!isRedeemed ? 'animate-shine' : ''}`}>
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-[10px] font-bold text-yellow-300 uppercase tracking-tighter">New Year Offer</p>
                                                <h3 className="text-xl font-black text-white">{currentDiscountData.text}</h3>
                                            </div>
                                            <div className="text-right">
                                                {isRedeemed ? (
                                                    <div className="bg-gray-800/50 px-3 py-1 rounded text-[10px] font-bold flex items-center gap-1">
                                                        <CheckCircle className="w-3 h-3" /> {t.redeemed}
                                                    </div>
                                                ) : (
                                                    <button onClick={() => setShowRedeemConfirm(true)} className="bg-yellow-400 text-red-900 px-3 py-1.5 rounded-lg text-[10px] font-black shadow-lg hover:bg-white active:scale-95 transition-all">
                                                        {t.redeem}
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                        <div className="mt-2 text-xs text-yellow-200/80 border-t border-white/20 pt-2 flex flex-col gap-0.5">
                                            <span className="font-medium">{currentDiscountData.note}</span>
                                            <span className="text-yellow-400 font-black">{t.exp}</span>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="mt-8 flex gap-3">
                        <button onClick={handleShare} className="flex-1 bg-gradient-to-r from-yellow-500 to-yellow-600 text-red-900 font-black py-4 rounded-xl shadow-xl flex items-center justify-center gap-2 hover:scale-[1.02] active:scale-95 transition-all border-b-4 border-yellow-800">
                            <Share2 className="w-6 h-6" />
                            {t.share}
                        </button>
                    </div>

                    <div className="mt-8 bg-black/20 backdrop-blur-md rounded-xl p-6 border border-yellow-500/30 text-white/80 text-xs">
                        <h4 className="text-yellow-400 font-black mb-3 flex items-center gap-2 text-sm">
                            <Info className="w-5 h-5" /> {t.noticeTitle}
                        </h4>
                        <ul className="space-y-2 list-none">
                            {t.notice.map((n, i) => <li key={i}>• {n}</li>)}
                        </ul>
                    </div>
                  </div>
                )}
              </main>

              <footer className="w-full text-center py-8 z-10">
                   {state === 'START' && (
                        <button onClick={() => setShowRules(true)} className="text-yellow-500/60 text-xs underline mb-4">
                            {t.ruleBtn}
                        </button>
                   )}
                   <div className="text-yellow-600/40 text-[10px] tracking-widest uppercase">
                        {t.footer}
                   </div>
              </footer>

              {/* 活動細則彈窗 */}
              {showRules && (
                  <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm animate-fade-in" onClick={() => setShowRules(false)}>
                      <div className="bg-white rounded-2xl w-full max-w-sm overflow-hidden border-4 border-red-800" onClick={e => e.stopPropagation()}>
                          <div className="bg-red-800 p-4 text-yellow-400 font-black text-center text-xl uppercase tracking-tighter">{t.rulesTitle}</div>
                          <div className="p-6 text-gray-700 text-sm leading-relaxed space-y-3 font-bold">
                             {t.rules.map((r, i) => <p key={i}>{r}</p>)}
                          </div>
                          <button onClick={() => setShowRules(false)} className="w-full bg-gray-100 py-4 font-bold text-gray-500 hover:bg-gray-200">{t.close}</button>
                      </div>
                  </div>
              )}

              {/* 核銷確認彈窗 */}
              {showRedeemConfirm && (
                  <div className="fixed inset-0 z-[110] flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm animate-fade-in">
                      <div className="bg-white rounded-2xl w-full max-w-sm overflow-hidden border-4 border-red-800 shadow-2xl">
                          <div className="bg-red-800 p-4 text-white font-black text-center text-xl">{t.redeemConfirmTitle}</div>
                          <div className="p-8 text-center">
                              <div className="mb-4 flex justify-center">
                                  <div className="bg-red-100 p-4 rounded-full">
                                      <Info className="w-10 h-10 text-red-600" />
                                  </div>
                              </div>
                              <p className="text-gray-800 font-bold text-lg mb-2">{t.redeemConfirmMsg}</p>
                              <p className="text-gray-500 text-sm leading-relaxed">
                                  {t.redeemConfirmSub}
                              </p>
                          </div>
                          <div className="flex border-t border-gray-100">
                              <button onClick={() => setShowRedeemConfirm(false)} className="flex-1 py-4 font-bold text-gray-400 hover:bg-gray-50 border-r border-gray-100">
                                {t.cancel}
                              </button>
                              <button onClick={executeRedeem} className="flex-1 py-4 font-black text-red-600 hover:bg-red-50">
                                {t.confirm}
                              </button>
                          </div>
                      </div>
                  </div>
              )}

              {/* Toast */}
              {showCopyToast && (
                  <div className="fixed bottom-10 left-1/2 -translate-x-1/2 z-[200] bg-yellow-400 text-red-900 px-6 py-3 rounded-full font-black shadow-2xl animate-fade-in text-xs">
                      {t.copyToast}
                  </div>
              )}
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>